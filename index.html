<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca por Curso</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { width: 80%; margin: 0 auto; padding-top: 20px; }
        #categorySelect, #institutionInput, #courseInput { width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; }
        #searchButton { padding: 10px 20px; cursor: pointer; }
        #results { margin-top: 20px; border: 1px solid #eee; padding: 10px; }
        .person { margin-bottom: 10px; padding: 10px; border-bottom: 1px dashed #ddd; }
        .person:last-child { border-bottom: none; }
        .header, .collab-section, .contact-section { text-align: center; margin-bottom: 20px; }
        .contact-section a { color: red; text-decoration: none; font-weight: bold; }
        .contact-section a:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <!-- CabeÃ§alho com explicaÃ§Ã£o -->
    <header class="header">
        <h1>ðŸ“š ProvÃ£o Paulista - Visualizador de Notas</h1>
        <p>Nosso objetivo Ã© ajudar vestibulandos a terem mais clareza sobre suas chances de aprovaÃ§Ã£o, oferecendo um simulador baseado nos dados de notas anteriores.</p>
    </header>

    
    <!-- ObservaÃ§Ã£o sobre as notas -->
    <div id="popup" class="popup">
    <h2>ObservaÃ§Ã£o</h2>
    <p>Os dados apresentados aqui sÃ£o baseados nas informaÃ§Ãµes enviadas por alunos. No futuro, teremos dados mais completos.</p>
    <button id="closePopup">Entendi</button>
</div>

    <!-- FormulÃ¡rio de busca -->
    <div class="container">
        <h1>Buscar Alunos por Curso e InstituiÃ§Ã£o</h1>

        <label for="categorySelect">Selecione a Categoria:</label>
        <select id="categorySelect">
            <option value="">Selecione uma categoria</option>
            <!-- Categorias serÃ£o carregadas aqui -->
        </select>

        <label for="institutionInput">Filtrar por InstituiÃ§Ã£o (opcional):</label>
        <input type="text" id="institutionInput" list="institutionsList" placeholder="Digite o nome da InstituiÃ§Ã£o (opcional)">
        <datalist id="institutionsList"></datalist>

        <label for="courseInput">Selecione ou digite o curso:</label>
        <input type="text" id="courseInput" list="coursesList" placeholder="Digite o nome do curso" disabled>
        <datalist id="coursesList"></datalist>

        <button id="searchButton" disabled>Buscar</button>

        <div id="results">
            <h2>Resultados:</h2>
            <div id="peopleList"></div>
        </div>
    </div>

    <!-- SeÃ§Ã£o para colaboraÃ§Ã£o -->
    <div class="collab-section">
        <h2>ðŸ“© Ajude outros estudantes!</h2>
        <p>Se vocÃª foi aprovado, compartilhe sua nota para ajudar futuros candidatos:</p>
        <a href="https://forms.gle/2cgZPhm3xofxtYFB8" target="_blank">ðŸ“‹ Enviar minha Nota</a>
    </div>


    <!-- Contato -->
    <div class="contact-section">
        <h2>ðŸ“ž Contato</h2>
        <p><strong>Kauan Yuri</strong></p>
        <p>ðŸ“± WhatsApp: <a href="https://wa.me/5516994297281" target="_blank">16 99429-7281</a></p>
        <p>ðŸ“· Instagram: <a href="https://www.instagram.com/dev.kauan" target="_blank">@dev.kauan</a></p>

        <p><strong>Felipe GalvÃ£o</strong></p>
        <p>ðŸ“± WhatsApp: <a href="https://wa.me/SEUNUMEROAQUI" target="_blank">Seu NÃºmero</a></p>
        <p>ðŸ“· Instagram: <a href="https://www.instagram.com/SEUINSTAGRAM" target="_blank">@SEUINSTAGRAM</a></p>
    </div>



    
    <script>
        const categorySelect = document.getElementById('categorySelect');
        const institutionInput = document.getElementById('institutionInput');
        const courseInput = document.getElementById('courseInput');
        const searchButton = document.getElementById('searchButton');
        const resultsDiv = document.getElementById('peopleList');
        const coursesList = document.getElementById('coursesList');
        const institutionsList = document.getElementById('institutionsList');
        let allCourses = {};
        let allInstitutions = {};
        let currentCategory = null;

     // Mostrar popup ao carregar
        popup.style.display = "block";
        closePopup.addEventListener("click", () => {
            popup.style.display = "none";
        });

        fetch('https://provao.onrender.com/categories')
            .then(response => response.json())
            .then(categories => {
                categories.forEach(category => {
                    let option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            });

        categorySelect.addEventListener('change', () => {
            currentCategory = categorySelect.value;
            courseInput.disabled = false;
            searchButton.disabled = false;
            courseInput.value = '';
            institutionInput.value = '';
            coursesList.innerHTML = '';
            institutionsList.innerHTML = '';

            if (currentCategory) {
                fetch(`https://provao.onrender.com/courses?category=${currentCategory}`)
                    .then(response => response.json())
                    .then(courses => {
                        allCourses[currentCategory] = courses;
                    });
                fetch(`https://provao.onrender.com/institutions?category=${currentCategory}`)
                    .then(response => response.json())
                    .then(institutions => {
                        allInstitutions[currentCategory] = institutions;
                    });
            } else {
                courseInput.disabled = true;
                searchButton.disabled = true;
            }
        });

        institutionInput.addEventListener('input', () => {
            const currentInput = institutionInput.value;
            institutionsList.innerHTML = '';

            if (currentInput.length >= 3 && currentCategory) {
                const categoryInstitutions = allInstitutions[currentCategory] || [];
                const filteredInstitutions = categoryInstitutions.filter(institution =>
                    institution.toLowerCase().startsWith(currentInput.toLowerCase())
                );

                filteredInstitutions.forEach(institution => {
                    let option = document.createElement('option');
                    option.value = institution;
                    institutionsList.appendChild(option);
                });
            }
        });

        courseInput.addEventListener('input', () => {
            const currentInput = courseInput.value;
            coursesList.innerHTML = '';

            if (currentInput.length >= 3 && currentCategory) {
                const categoryCourses = allCourses[currentCategory] || [];
                const filteredCourses = categoryCourses.filter(course =>
                    course.toLowerCase().startsWith(currentInput.toLowerCase())
                );

                filteredCourses.forEach(course => {
                    let option = document.createElement('option');
                    option.value = course;
                    coursesList.appendChild(option);
                });
            }
        });

        searchButton.addEventListener('click', () => {
            const selectedCourse = courseInput.value;
            const selectedInstitution = institutionInput.value;
            if (!selectedCourse) {
                alert("Por favor, digite ou selecione um curso.");
                return;
            }

            if (!currentCategory) {
                alert("Por favor, selecione uma categoria.");
                return;
            }

            const requestBody = { course: selectedCourse, category: currentCategory };
            if (selectedInstitution) {
                requestBody.institution = selectedInstitution;
            }

            fetch('https://provao.onrender.com/filter_course', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            })
            .then(response => response.json())
            .then(people => {
                resultsDiv.style.display = 'block'; // Show results div on search
                resultsDiv.innerHTML = people.length > 0 ? people.map(person => `
                    <div class="person">
                        <p><strong>InstituiÃ§Ã£o:</strong> ${person.InstituiÃ§Ã£o}</p>
                        <p><strong>Curso:</strong> ${person.Curso}</p>
                        <p><strong>Nota:</strong> ${person.Nota}</p>
                        <p><strong>Grupo:</strong> ${person.Grupo}</p>
                    </div>`).join('') : '<p>Nenhum aluno encontrado.</p>';
            });
        });
    </script>

</body>
</html>
